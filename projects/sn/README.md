# Проект Социальная Сеть

## Установка NodeJS

```
sudo apt-get install curl
curl -sL https://deb.nodesource.com/setup_13.x | sudo -E bash -
sudo apt-get install -y nodejs
```

## Установка сервера и зависимостей


```
cd ~/development/school444/projects
git pull
cp -R sn ~/development/sn
cd ~/development/sn
npm install
``` 

## Запуск сервера

```
node app.js
```

## Останоовка сервера

```
Ctrl + C
```

## Что дальше

1. Написать персональное приветствие
2. Логин фиксированного пользователя
* Создать путь /login
* Создать страницу и форму
* Создать массив пользователей
* Получить поля POST
* Проверить логин и пароль
* Показать страницы ошибки и успеха

## Движемся дальше (4 декабря)

Большинство из вас справилось с предыдущими пунктами и смогли проверить логин и пароль, а также выдать сообщение об ошибке, если пароль введен неверно. Если кто-то еще не сделал этот функционал, продолжайте делать и спрашивайте у товарищей, если вдруг по пути встретите какие-то проблемы.

### Регистрация

Некоторые из вас также справились с регистрацией, но не все, поэтому объясню подробно как ее сделать.

Сначала нужно научиться сериализовать объекты (переводить в строковый вид). Для этого в JS используется функция `JSON.stringify`, например вот так для объектра users, который хранит логины и пароли пользователей:

```
JSON.stringify(users);
```

Обратная этой функции, т.е. функция, которая делает из строки объект, которым вы можете пользоваться для проверки логинов и паролей, - это `JSON.parse`.

Теперь, когда вы можете превращать объект в строку и обратно, остается только сохранить эту строку в текстовом файле. Делается это при помощи функции `writeFileSync` модуля `fs`:

```
// Вначале нужно импортировать модуль fs
const fs = require("fs");

// Для записи строки "Hello, text files" в файл users.json нужно вызвать функцию вот так:
fs.writeFileSync("users.json", 'Hello, text files');

```

Конечно же, чтобы работала регистрация, вам нужно записывать в файл не "Hello, text files", а сериализованный объект логинов и паролей.

Итак, все шаги, необходимые для реализации регистрации:

1. Реализовать сохранение объекта users в файл users.json и его загрузку оттуда
2. Создать ссылку и страницу для регистрации. Ссылку поместить на той же странице, где у вас форма логина. Напоминаю, что новая страница создается добавлением в файл app.js вот такой конструкции, где указывается адрес этой страницы и что она должна выдавать в браузер в параметрах вызова res.send:

```
app.get('/registration', function (req, res) {
	res.send(`
		Hello World!<br>
		`);
});
```
3. В форме регистрации нужно создать все необходимые поля, такие как желаемый логин, пароль, повторение пароля и кнопка Register.
4. Кнопка Register должна вызывать JavaScript фукнцию RegisterFunc на странице при помощи своего обработчика onclick.
5. Функция RegisterFunc должна извлекать логин и пароль из формы регистрации и формировать вот такой запрос:

```
/doregister?login=newuserlogin&password=newuserpass
```

Где "newuserlogin" и "newuserpass" - это логин и пароль, введенные пользователем.

И вызывать этот запрос при помощи вот такого вызова на JavaScript: `window.location.href = "... новый URL ... ";`

6. Далее нужно создать новую страницу doregister, которая будет выполнять регистрацию, то есть загружать файл пользователей в объект, добавлять в этот объект нового пользователя и сохранять объект обратно в файл.

7. Также нужно поменять страницу логина, чтобы она проверяла логины и пароли, загружая их каждый раз из файла users.json.

### Профайлы пользователей

Теперь у нас уже есть самое базовое - это возможность зайти на сайт и залогиниться. Но пока нет никакого содержания сайта, давайте его добавим.

У каждого пользователя будет персональное приветствие и фотография. Фотографии мы пока будем хранить не на своем сервере, а на сторонних, а у себя будем хранить только ссылку на это фото. Прежде чем начать работать с этим разделом, загрузите свое фото (или любое фото) на какой-то сторонний сервис хостинга фотографий. Вот пример того какой URL в результате вы должны получить:

https://i.imgur.com/B0NVItK.jpg

В этом разделе мы сделаем несколько вещей:

#### Страница добавления фото и личного приветствия

Для этого создайте две новые страницу по аналогии с тем, как вы это делали для страницы регистрации. Но только с одним небольшим изменением. Дело в том, что теперь эта страница должна быть доступна только зарегистрированным пользователям и вам нужно знать какой пользователь сейчас залогинился. Сейчас мы это сделаем очень простым путем, насколько простым, что он даже неправильный, но для обучения так делать можно. В URL страницы мы будем передавать логин пользователя, например вот так:

```
/profileedit?login=vasya
```

Теперь страница знает, что на нее зашел vasya и может извлечь его логин из параметров URL вот таким образом:

```
let user = req.query.login;
```

А затем найти пользователя в объекте пользователей, загруженном из файла users.json, все как при логине. Потом поменять данные пользователя, а именно добавить немного полей в объект, таких как "image_url" и "personal_greeting" и сохранить пользователя обратно в файл. Добавляются поля очень просто:

```
users[login]["image_url"] = ...
users[login]["personal_greeting"] = ...
```

#### Страница отображения всех пользователей

Нужно создать новую страницу, где будут показаны все зарегистрированные пользователи сайта, а именно их картинка, персональное приветствие и логин. В цикле нужно добавить HTML таблицу, которая будет содержать все эти поля. Можно применять чувство прекрасного для форматирования этой таблицы без ограничений! :)


На следующем уроки будем делать лайки. Лайки - это не только весело, но и объясняет основы реляционных баз данных. Кто хочет, можете начать сразу.


